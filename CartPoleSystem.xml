<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>//Channels
broadcast chan left, right;

//Constants
const double G = 9.8;
const double MASS_CART = 1.0;
const double MASS_POLE = 0.1;
const double MASS_TOTAL = MASS_CART + MASS_POLE;
const double POLE_LENGTH = 0.5;
const double MASS_POLE_LENGTH = MASS_CART * POLE_LENGTH;
const double F = 10.0;

//Thresholds
const double CART_POS_LIMIT = 4.8;
const double CART_POS_TERMINATION_LIMIT = 2.4;

const double POLE_ANGLE_LIMIT = 0.418;
const double POLE_ANGLE_TERMINATION_LIMIT = 0.2095;

const double MAX_COST

//Observation space
clock cart_pos, cart_vel, pole_ang, pole_vel;
clock time, cost;
int deaths = 0;

//Applied force on cart
double force = 0;

//Functions extracted from the Gymnasium source code
double temp() {
    return (force + MASS_POLE_LENGTH * pow(pole_vel, 2)) / MASS_TOTAL;
}

double pole_acc() {
    return (G * sin(pole_ang) - cos(pole_ang) * temp()) / (POLE_LENGTH * (4.0 / 3.0 - MASS_POLE * pow(cos(pole_ang), 2) / MASS_TOTAL));
}

double cart_acc() {
    return temp() - (MASS_POLE_LENGTH * pole_acc() * cos(pole_ang) / MASS_TOTAL);
}</declaration>
	<template>
		<name x="5" y="5">Agent</name>
		<declaration>clock t;</declaration>
		<location id="id0" x="51" y="314">
			<name x="41" y="280">Init</name>
			<label kind="invariant" x="-42" y="289">t&lt;=1 &amp;&amp;
t'==50</label>
			<label kind="exponentialrate" x="41" y="348">1</label>
		</location>
		<location id="id1" x="323" y="314">
			<name x="313" y="280">Control</name>
			<committed/>
		</location>
		<init ref="id0"/>
		<transition id="id2">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="144" y="425">right!</label>
			<nail x="187" y="408"/>
		</transition>
		<transition id="id3">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="161" y="195">left!</label>
			<nail x="187" y="229"/>
		</transition>
		<transition id="id4" controllable="false">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="guard" x="136" y="314">t==1</label>
			<label kind="assignment" x="221" y="314">t=0</label>
		</transition>
	</template>
	<template>
		<name>CartPole</name>
		<location id="id5" x="-960" y="442">
			<name x="-1020" y="425">Init</name>
			<urgent/>
		</location>
		<location id="id6" x="-459" y="442">
			<name x="-469" y="408">Running1</name>
			<label kind="invariant" x="-469" y="459">cart_pos' == cart_vel &amp;&amp; 
cart_vel' == cart_acc() &amp;&amp;
pole_ang' == pole_vel &amp;&amp; 
pole_vel' == pole_acc() &amp;&amp;
cost' == -1</label>
		</location>
		<location id="id7" x="-459" y="178">
			<name x="-469" y="144">Running2</name>
			<committed/>
		</location>
		<location id="id8" x="-459" y="-85">
			<name x="-469" y="-119">End</name>
			<label kind="invariant" x="-510" y="-229">cart_pos' == 0 &amp;&amp; 
cart_vel' == 0 &amp;&amp;
pole_ang' == 0 &amp;&amp; 
pole_vel' == 0 &amp;&amp;
cost' == 0</label>
			<committed/>
		</location>
		<init ref="id5"/>
		<transition id="id9">
			<source ref="id7"/>
			<target ref="id8"/>
			<nail x="-620" y="42"/>
		</transition>
		<transition id="id10" controllable="false">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-382" y="59">pole_ang &gt; POLE_ANGLE_TERMINATION_LIMIT</label>
			<nail x="-365" y="42"/>
		</transition>
		<transition id="id11" controllable="false">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-833" y="34">cart_pos &lt; -CART_POS_TERMINATION_LIMIT</label>
			<nail x="-561" y="42"/>
		</transition>
		<transition id="id12" controllable="false">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-484" y="25">pole_ang &lt; -POLE_ANGLE_TERMINATION_LIMIT</label>
			<nail x="-416" y="42"/>
		</transition>
		<transition id="id13" controllable="false">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-799" y="68">cart_pos  &gt;CART_POS_TERMINATION_LIMIT</label>
			<nail x="-510" y="42"/>
		</transition>
		<transition id="id14">
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-297" y="221">right?</label>
			<label kind="assignment" x="-297" y="238">force = F</label>
			<nail x="-306" y="365"/>
			<nail x="-306" y="221"/>
		</transition>
		<transition id="id15">
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-671" y="221">left?</label>
			<label kind="assignment" x="-714" y="238">force = -F</label>
			<nail x="-612" y="357"/>
			<nail x="-612" y="221"/>
		</transition>
		<transition id="id16" controllable="false">
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="guard" x="-620" y="280">cart_pos &gt;= -CART_POS_TERMINATION_LIMIT &amp;&amp;
cart_pos &lt;= CART_POS_TERMINATION_LIMIT &amp;&amp;
pole_ang &gt;= -POLE_ANGLE_TERMINATION_LIMIT &amp;&amp; 
pole_ang &lt;= POLE_ANGLE_TERMINATION_LIMIT</label>
		</transition>
		<transition id="id17" controllable="false">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="assignment" x="-1020" y="476">cart_pos = -0.05 + random(0.1), cart_vel = -0.05 + random(0.1),
pole_ang = -0.05 + random(0.1), pole_vel = -0.05 + random(0.1)</label>
		</transition>
	</template>
	<system>system Agent, CartPole;</system>
	<queries>
		<query>
			<formula>E[&lt;=10;1000] (max: deaths)</formula>
			<comment/>
			<result outcome="success" type="quantity" value="23.764 ± 0.168849 (95% CI)" timestamp="2024-05-16 13:30:20 +0200">
				<details>23.764 ± 0.168849 (95% CI)</details>
				<plot title="Probability Density Distribution" xaxis="max: deaths" yaxis="probability density">
					<series title="density" type="b(1.000000)" color="0x0000ff" encoding="csv">16.0,0.004
17.0,0.008
18.0,0.008
19.0,0.037
20.0,0.07
21.0,0.086
22.0,0.1
23.0,0.136
24.0,0.161
25.0,0.124
26.0,0.105
27.0,0.08
28.0,0.041
29.0,0.023
30.0,0.014
31.0,0.002
32.0,0.001
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">23.764,0.0
23.764,0.161
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=17
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [16, 32]
Mean estimate of displayed sample: 23.764 ± 0.16885 (95% CI)</comment>
				</plot>
				<plot title="Probability Distribution" xaxis="max: deaths" yaxis="probability">
					<series title="probability" type="b(1.000000)" color="0x0000ff" encoding="csv">16.0,0.004
17.0,0.008
18.0,0.008
19.0,0.037
20.0,0.07
21.0,0.086
22.0,0.1
23.0,0.136
24.0,0.161
25.0,0.124
26.0,0.105
27.0,0.08
28.0,0.041
29.0,0.023
30.0,0.014
31.0,0.002
32.0,0.001
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">23.764,0.0
23.764,0.161
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=17
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [16, 32]
Mean estimate of displayed sample: 23.764 ± 0.16885 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Distribution" xaxis="max: deaths" yaxis="probability">
					<series title="cumulative" type="l" color="0x000000" encoding="csv">16.0,0.0
17.0,0.004
18.0,0.012
19.0,0.02
20.0,0.057
21.0,0.127
22.0,0.213
23.0,0.313
24.0,0.449
25.0,0.61
26.0,0.734
27.0,0.839
28.0,0.919
29.0,0.96
30.0,0.983
31.0,0.997
32.0,0.999
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">23.764,0.0
23.764,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=17
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [16, 32]
Mean estimate of displayed sample: 23.764 ± 0.16885 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Confidence Intervals" xaxis="max: deaths" yaxis="probability">
					<series title="upper limit" type="k" color="0x0000dd" encoding="csv">16.0,0.003682083896865672
17.0,0.010209664683929873
18.0,0.020867679591036414
19.0,0.030720032682609113
20.0,0.07322272946066227
21.0,0.14924003033485816
22.0,0.2397029679261252
23.0,0.34276041575003163
24.0,0.4804401427121303
25.0,0.6403686600273827
26.0,0.7611644251366967
27.0,0.8612550075726405
28.0,0.935156460291505
29.0,0.9712723747141092
30.0,0.9900664874072834
31.0,0.9993809000683505
32.0,0.9999746825125088
					</series>
					<series title="lower limit" type="k" color="0xdd0000" encoding="csv">16.0,0.0
17.0,0.0010909079877259719
18.0,0.006215525559595242
19.0,0.012258267972406325
20.0,0.0434535819369586
21.0,0.1069843269494534
22.0,0.1879988518060795
23.0,0.2843452029487085
24.0,0.4178609383862795
25.0,0.5789816842711826
26.0,0.7054505633196609
27.0,0.8147291413174371
28.0,0.9003283010315127
29.0,0.9459273031806316
30.0,0.9729205031351487
31.0,0.9912579767615217
32.0,0.9944410757201734
					</series>
					<series title="cumulative" type="l" color="0x000000" encoding="csv">16.0,0.0
17.0,0.004
18.0,0.012
19.0,0.02
20.0,0.057
21.0,0.127
22.0,0.213
23.0,0.313
24.0,0.449
25.0,0.61
26.0,0.734
27.0,0.839
28.0,0.919
29.0,0.96
30.0,0.983
31.0,0.997
32.0,0.999
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">23.764,0.0
23.764,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=17
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [16, 32]
Mean estimate of displayed sample: 23.764 ± 0.16885 (95% CI)</comment>
				</plot>
				<plot title="Frequency Histogram" xaxis="max: deaths" yaxis="count">
					<series title="count" type="b(1.000000)" color="0x0000ff" encoding="csv">16.0,4.0
17.0,8.0
18.0,8.0
19.0,37.0
20.0,70.0
21.0,86.0
22.0,100.0
23.0,136.0
24.0,161.0
25.0,124.0
26.0,105.0
27.0,80.0
28.0,41.0
29.0,23.0
30.0,14.0
31.0,2.0
32.0,1.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">23.764,0.0
23.764,161.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=17
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [16, 32]
Mean estimate of displayed sample: 23.764 ± 0.16885 (95% CI)</comment>
				</plot>
			</result>
		</query>
		<query>
			<formula>strategy StayAlive = minE (deaths) [&lt;=10] {} -&gt; {cart_pos, cart_vel, pole_ang, pole_vel}: &lt;&gt; time &gt;= 10</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2024-05-16 13:32:42 +0200">
			</result>
		</query>
		<query>
			<formula>E[&lt;=10;1000] (max: deaths) under StayAlive</formula>
			<comment/>
			<result outcome="success" type="quantity" value="0.001 ± 0.00196234 (95% CI)" timestamp="2024-05-16 13:33:18 +0200">
				<details>0.001 ± 0.00196234 (95% CI)</details>
				<plot title="Probability Density Distribution" xaxis="max: deaths" yaxis="probability density">
					<series title="density" type="b(1.000000)" color="0x0000ff" encoding="csv">0.0,0.999
1.0,0.001
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">0.001,0.0
0.001,0.999
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=2
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [0, 1]
Mean estimate of displayed sample: 0.001 ± 0.00196 (95% CI)</comment>
				</plot>
				<plot title="Probability Distribution" xaxis="max: deaths" yaxis="probability">
					<series title="probability" type="b(1.000000)" color="0x0000ff" encoding="csv">0.0,0.999
1.0,0.001
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">0.001,0.0
0.001,0.999
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=2
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [0, 1]
Mean estimate of displayed sample: 0.001 ± 0.00196 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Distribution" xaxis="max: deaths" yaxis="probability">
					<series title="cumulative" type="l" color="0x000000" encoding="csv">0.0,0.0
1.0,0.999
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">0.001,0.0
0.001,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=2
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [0, 1]
Mean estimate of displayed sample: 0.001 ± 0.00196 (95% CI)</comment>
				</plot>
				<plot title="Cumulative Probability Confidence Intervals" xaxis="max: deaths" yaxis="probability">
					<series title="upper limit" type="k" color="0x0000dd" encoding="csv">0.0,0.003682083896865672
1.0,0.9999746825125088
					</series>
					<series title="lower limit" type="k" color="0xdd0000" encoding="csv">0.0,0.0
1.0,0.9944410757201734
					</series>
					<series title="cumulative" type="l" color="0x000000" encoding="csv">0.0,0.0
1.0,0.999
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">0.001,0.0
0.001,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=2
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [0, 1]
Mean estimate of displayed sample: 0.001 ± 0.00196 (95% CI)</comment>
				</plot>
				<plot title="Frequency Histogram" xaxis="max: deaths" yaxis="count">
					<series title="count" type="b(1.000000)" color="0x0000ff" encoding="csv">0.0,999.0
1.0,1.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">0.001,0.0
0.001,999.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=1, bucket count=2
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [0, 1]
Mean estimate of displayed sample: 0.001 ± 0.00196 (95% CI)</comment>
				</plot>
			</result>
		</query>
	</queries>
</nta>
