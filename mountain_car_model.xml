<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>typedef int[0,2] eng;

//Channels
broadcast chan left, right, free;

//Cost 
clock cost, t, time;

//Constants
const double FORCE = 0.001;
const double G = 0.0025;
const double WIN_POS = 0.5;
const double MAX_TIME = 200;

//Thresholds
const double pos_max = 0.6;
const double pos_min = -1.2;
const double vel_max = 0.07;
const double vel_min = -0.07;

//Min function
double min(double a, double b){
    return a &lt; b? a : b;
}

//Max function
double max(double a, double b){
    return a &gt; b? a : b;
}

//Clip function
double clip(double val, double min_val, double max_val) {
    return max(min_val, min(max_val, val));
}

//Car properties
hybrid clock vel=0, pos=0;
eng engine; //  0 = left, 1 = free, 2 = right


double vel_delta() {
    if (vel &lt;= vel_min || vel &gt;= vel_max)
        return 0;

    return (engine - 1) * FORCE - cos(3 * pos) * G;
}

double pos_delta() {
    if (pos &lt;= pos_min || pos &gt;= pos_max)
        return 0;

    return vel;
}

//Misc
//Clip all
void clip_all() {
    pos = clip(pos, pos_min, pos_max);
    vel = clip(vel, vel_min, vel_max);
}</declaration>
	<template>
		<name>Agent</name>
		<location id="id0" x="-229" y="-110">
			<name x="-280" y="-119">Init</name>
			<label kind="invariant" x="-195" y="-85">t&lt;=1 &amp;&amp;
t' == 1</label>
		</location>
		<location id="id1" x="144" y="-110">
			<name x="161" y="-119">Control</name>
			<committed/>
		</location>
		<location id="id2" x="144" y="51">
			<name x="170" y="42">Mojn</name>
		</location>
		<init ref="id0"/>
		<transition id="id3" controllable="false">
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="guard" x="153" y="-59">pos &gt;= WIN_POS &amp;&amp;
time &gt;= MAX_TIME</label>
		</transition>
		<transition id="id4">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-68" y="-289">free!</label>
			<nail x="195" y="-153"/>
			<nail x="195" y="-195"/>
			<nail x="-51" y="-306"/>
			<nail x="-280" y="-195"/>
			<nail x="-280" y="-144"/>
		</transition>
		<transition id="id5">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-68" y="-238">right!</label>
			<nail x="144" y="-161"/>
			<nail x="-51" y="-255"/>
			<nail x="-229" y="-170"/>
		</transition>
		<transition id="id6" controllable="false">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="guard" x="-102" y="-110">t==1</label>
			<label kind="assignment" x="-34" y="-110">t=0</label>
		</transition>
		<transition id="id7">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-68" y="-178">left!</label>
			<nail x="-51" y="-204"/>
		</transition>
	</template>
	<template>
		<name>MountainCar</name>
		<location id="id8" x="-807" y="76">
			<name x="-892" y="68">Initial</name>
			<committed/>
		</location>
		<location id="id9" x="-433" y="76">
			<name x="-425" y="85">Driving1</name>
			<label kind="invariant" x="-493" y="127">vel' == vel_delta() &amp;&amp;
pos' == pos_delta()</label>
		</location>
		<location id="id10" x="-433" y="-178">
			<name x="-527" y="-187">Driving2</name>
			<committed/>
		</location>
		<location id="id11" x="-433" y="-340">
			<name x="-442" y="-382">End</name>
			<label kind="invariant" x="-391" y="-408">pos' == 0 &amp;&amp;
vel' == 0 &amp;&amp;
cost' == 0</label>
		</location>
		<init ref="id8"/>
		<transition id="id12" controllable="false">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="guard" x="-697" y="-272">time &gt;= MAX_TIME</label>
			<nail x="-535" y="-263"/>
		</transition>
		<transition id="id13" controllable="false">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="guard" x="-416" y="-306">pos &gt;= WIN_POS</label>
		</transition>
		<transition id="id14" controllable="false">
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-289" y="-76">right?</label>
			<label kind="assignment" x="-289" y="-59">engine = 2</label>
			<nail x="-340" y="76"/>
			<nail x="-297" y="25"/>
			<nail x="-297" y="-136"/>
			<nail x="-340" y="-178"/>
		</transition>
		<transition id="id15" controllable="false">
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-357" y="-76">free?</label>
			<label kind="assignment" x="-382" y="-59">engine = 1</label>
			<nail x="-365" y="17"/>
			<nail x="-365" y="-136"/>
		</transition>
		<transition id="id16" controllable="false">
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-595" y="-85">left?</label>
			<label kind="assignment" x="-595" y="-68">engine = 0</label>
			<nail x="-501" y="17"/>
			<nail x="-501" y="-127"/>
		</transition>
		<transition id="id17" controllable="false">
			<source ref="id10"/>
			<target ref="id9"/>
			<label kind="guard" x="-493" y="0">pos &lt; WIN_POS &amp;&amp;
time &lt; MAX_TIME</label>
			<label kind="assignment" x="-476" y="-17">clip_all()</label>
		</transition>
		<transition id="id18" controllable="false">
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="assignment" x="-697" y="76">pos = -0.5,
vel = 0,
cost = 0,
time = 0</label>
		</transition>
	</template>
	<system>system MountainCar, Agent;</system>
	<simulator type="concrete">
		<plot-widget title="pos">
			<expression>pos</expression>
		</plot-widget>
	</simulator>
	<queries>
		<query>
			<formula>Pr[&lt;=10000](&lt;&gt; MountainCar.Win) under winQuick</formula>
			<comment/>
		</query>
		<query>
			<formula>strategy winQuick = minE (cost) [&lt;=200] {} -&gt; {pos, vel}: &lt;&gt; time &gt;=200 || MountainCar.End</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2024-05-13 16:32:48 +0200">
				<option key="--total-runs" value="1000"/>
				<option key="--reset-no-better" value="100"/>
			</result>
		</query>
		<query>
			<formula>E[&lt;=201;1000] (max: cost)</formula>
			<comment/>
			<result outcome="success" type="quantity" value="≈ 200" timestamp="2024-05-10 14:15:09 +0200">
				<option key="--state-representation" value="2"/>
				<option key="--hashtable-size" value="32"/>
				<option key="--statespace-consumption" value="2"/>
				<option key="--diagnostic" value="2"/>
				<details>≈ 200</details>
				<plot title="Probability Density Distribution" xaxis="max: cost" yaxis="probability density">
					<series title="density" type="b(0.000000)" color="0x0000ff" encoding="csv">200.0,4.503599627370496E15
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,4.503599627370496E15
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Probability Distribution" xaxis="max: cost" yaxis="probability">
					<series title="probability" type="b(0.000000)" color="0x0000ff" encoding="csv">200.0,1.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Cumulative Probability Distribution" xaxis="max: cost" yaxis="probability">
					<series title="cumulative" type="l" color="0x000000" encoding="csv">200.0,0.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Cumulative Probability Confidence Intervals" xaxis="max: cost" yaxis="probability">
					<series title="upper limit" type="k" color="0x0000dd" encoding="csv">200.0,0.003682083896865672
					</series>
					<series title="lower limit" type="k" color="0xdd0000" encoding="csv">200.0,0.0
					</series>
					<series title="cumulative" type="l" color="0x000000" encoding="csv">200.0,0.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Frequency Histogram" xaxis="max: cost" yaxis="count">
					<series title="count" type="b(0.000000)" color="0x0000ff" encoding="csv">200.0,1000.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1000.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 1000 in total, 1000 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
			</result>
		</query>
		<query>
			<formula>E[&lt;=200;100] (max: cost) under winQuick </formula>
			<comment/>
			<result outcome="success" type="quantity" value="≈ 200" timestamp="2024-05-13 16:30:21 +0200">
				<option key="--total-runs" value="1000"/>
				<details>≈ 200</details>
				<plot title="Probability Density Distribution" xaxis="max: cost" yaxis="probability density">
					<series title="density" type="b(0.000000)" color="0x0000ff" encoding="csv">200.0,4.503599627370496E15
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,4.503599627370496E15
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 100 in total, 100 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Probability Distribution" xaxis="max: cost" yaxis="probability">
					<series title="probability" type="b(0.000000)" color="0x0000ff" encoding="csv">200.0,1.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 100 in total, 100 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Cumulative Probability Distribution" xaxis="max: cost" yaxis="probability">
					<series title="cumulative" type="l" color="0x000000" encoding="csv">200.0,0.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 100 in total, 100 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Cumulative Probability Confidence Intervals" xaxis="max: cost" yaxis="probability">
					<series title="upper limit" type="k" color="0x0000dd" encoding="csv">200.0,0.03621669264517642
					</series>
					<series title="lower limit" type="k" color="0xdd0000" encoding="csv">200.0,0.0
					</series>
					<series title="cumulative" type="l" color="0x000000" encoding="csv">200.0,0.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,1.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 100 in total, 100 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
				<plot title="Frequency Histogram" xaxis="max: cost" yaxis="count">
					<series title="count" type="b(0.000000)" color="0x0000ff" encoding="csv">200.0,100.0
					</series>
					<series title="average" type="pl" color="0x00dd00" encoding="csv">200.0,0.0
200.0,100.0
					</series>
					<comment>Parameters: α=0.05, ε=0.05, bucket width=2.2204e-16, bucket count=1
Runs: 100 in total, 100 (100%) displayed, 0 (0%) remaining
Span of displayed sample: [200, 200]
Mean estimate of displayed sample: ≈ 200</comment>
				</plot>
			</result>
		</query>
		<query>
			<formula>simulate [&lt;=200] {MountainCar.Win}</formula>
			<comment/>
		</query>
		<query>
			<formula>strategy nice = </formula>
			<comment/>
		</query>
		<query>
			<formula>strategy winQuick = minE (cost) [&lt;=201]: &lt;&gt; MountainCar.End</formula>
			<comment/>
		</query>
	</queries>
</nta>
